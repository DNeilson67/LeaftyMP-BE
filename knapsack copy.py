all_data = {
  "centraAB": [
    {
      "id": 1,
      "weight": 30
    },
    {
      "id": 2,
      "weight": 30
    },
    {
      "id": 5,
      "weight": 30
    },
    {
      "id": 7,
      "weight": 30
    },
    {
      "id": 8,
      "weight": 30
    },
    {
      "id": 9,
      "weight": 30
    },
    {
      "id": 11,
      "weight": 30
    },
    {
      "id": 12,
      "weight": 30
    },
    {
      "id": 13,
      "weight": 30
    },
    {
      "id": 14,
      "weight": 30
    },
    {
      "id": 15,
      "weight": 10
    },
    {
      "id": 16,
      "weight": 10
    },
    {
      "id": 17,
      "weight": 10
    },
    {
      "id": 18,
      "weight": 2.5
    },
    {
      "id": 19,
      "weight": 10
    },
    {
      "id": 20,
      "weight": 10
    },
    {
      "id": 21,
      "weight": 30
    },
    {
      "id": 22,
      "weight": 10
    },
    {
      "id": 23,
      "weight": 30
    },
    {
      "id": 25,
      "weight": 30
    },
    {
      "id": 27,
      "weight": 10
    },
    {
      "id": 28,
      "weight": 30
    },
    {
      "id": 3,
      "weight": 0
    },
    {
      "id": 4,
      "weight": 30
    },
    {
      "id": 6,
      "weight": 40
    },
    {
      "id": 10,
      "weight": 67
    },
    {
      "id": 29,
      "weight": 10
    },
    {
      "id": 30,
      "weight": 10
    },
    {
      "id": 31,
      "weight": 10
    },
    {
      "id": 32,
      "weight": 30
    },
    {
      "id": 2124,
      "weight": 30
    }
  ],
  "gs": [
    {
      "id": 2943,
      "weight": 60
    },
    {
      "id": 2944,
      "weight": 51
    },
    {
      "id": 2945,
      "weight": 75
    },
    {
      "id": 2946,
      "weight": 60
    },
    {
      "id": 2947,
      "weight": 77
    },
    {
      "id": 2948,
      "weight": 78
    },
    {
      "id": 2949,
      "weight": 69
    },
    {
      "id": 2950,
      "weight": 63
    },
    {
      "id": 2951,
      "weight": 67
    },
    {
      "id": 2952,
      "weight": 44
    },
    {
      "id": 2953,
      "weight": 62
    },
    {
      "id": 2954,
      "weight": 55
    },
    {
      "id": 2955,
      "weight": 68
    },
    {
      "id": 2956,
      "weight": 49
    },
    {
      "id": 2957,
      "weight": 70
    },
    {
      "id": 2958,
      "weight": 75
    },
    {
      "id": 2959,
      "weight": 46
    },
    {
      "id": 2960,
      "weight": 48
    },
    {
      "id": 2961,
      "weight": 67
    },
    {
      "id": 2962,
      "weight": 72
    },
    {
      "id": 2963,
      "weight": 70
    },
    {
      "id": 2964,
      "weight": 70
    },
    {
      "id": 2965,
      "weight": 78
    },
    {
      "id": 2966,
      "weight": 76
    },
    {
      "id": 2967,
      "weight": 54
    },
    {
      "id": 2968,
      "weight": 70
    },
    {
      "id": 2969,
      "weight": 40
    },
    {
      "id": 2970,
      "weight": 80
    },
    {
      "id": 2971,
      "weight": 60
    },
    {
      "id": 2972,
      "weight": 61
    },
    {
      "id": 2973,
      "weight": 73
    },
    {
      "id": 2974,
      "weight": 42
    },
    {
      "id": 2925,
      "weight": 70
    },
    {
      "id": 2926,
      "weight": 48
    },
    {
      "id": 2927,
      "weight": 74
    },
    {
      "id": 2928,
      "weight": 47
    }
  ],
  "centraaz": [
    {
      "id": 2975,
      "weight": 77
    },
    {
      "id": 2976,
      "weight": 58
    },
    {
      "id": 2977,
      "weight": 77
    },
    {
      "id": 2978,
      "weight": 69
    },
    {
      "id": 2979,
      "weight": 40
    },
    {
      "id": 2980,
      "weight": 71
    },
    {
      "id": 2981,
      "weight": 60
    },
    {
      "id": 2982,
      "weight": 75
    },
    {
      "id": 2983,
      "weight": 41
    },
    {
      "id": 2984,
      "weight": 70
    },
    {
      "id": 2985,
      "weight": 54
    },
    {
      "id": 2986,
      "weight": 70
    },
    {
      "id": 2987,
      "weight": 44
    },
    {
      "id": 2988,
      "weight": 72
    },
    {
      "id": 2989,
      "weight": 61
    },
    {
      "id": 2990,
      "weight": 55
    },
    {
      "id": 2991,
      "weight": 52
    },
    {
      "id": 2992,
      "weight": 78
    },
    {
      "id": 2993,
      "weight": 72
    },
    {
      "id": 2994,
      "weight": 44
    },
    {
      "id": 2995,
      "weight": 61
    },
    {
      "id": 2996,
      "weight": 46
    },
    {
      "id": 2997,
      "weight": 59
    },
    {
      "id": 2998,
      "weight": 44
    },
    {
      "id": 2999,
      "weight": 76
    },
    {
      "id": 3000,
      "weight": 66
    },
    {
      "id": 3001,
      "weight": 44
    },
    {
      "id": 3002,
      "weight": 53
    },
    {
      "id": 3003,
      "weight": 74
    },
    {
      "id": 3004,
      "weight": 60
    },
    {
      "id": 3005,
      "weight": 73
    },
    {
      "id": 3006,
      "weight": 63
    },
    {
      "id": 3007,
      "weight": 58
    }
  ]
}

def extract_weights(data):
    result = {}
    for key, items in data.items():
        result[key] = [item["weight"] for item in items]
    return result

formatted_data = extract_weights(all_data)
print(formatted_data)

memo: dict[tuple[int, int], int] = {}
next: dict[tuple[int, int], tuple[int, int, bool]] = {}

def dp(weight: int, idx: int, items: list[tuple[int, str, int]]) -> int:
    if memo.get((weight, idx), -1) != -1:
        return memo.get((weight, idx))
    if weight <= 0 or idx >= len(items):
        return 0

    # Decision to include the current item
    if weight - items[idx][0] >= 0:
        next[(weight, idx)] = (weight - items[idx][0], idx + 1, True)
        memo[(weight, idx)] = dp(weight - items[idx][0], idx + 1, items=items) + items[idx][0]

    # Decision to skip the current item
    skip_value = dp(weight, idx + 1, items=items)
    if memo.get((weight, idx), 0) < skip_value:
        next[(weight, idx)] = (weight, idx + 1, False)
        memo[(weight, idx)] = skip_value

    return memo.get((weight, idx), 0)

def knapsack(target_weight: int, item_weights: dict[str, list[dict[str, int]]]):
    items: list[tuple[int, str, int]] = []
    memo.clear()
    next.clear()
    
    # Flatten input structure into list of (weight, category, id) tuples
    for category, weights in item_weights.items():
        items += [(item["weight"], category, item["id"]) for item in weights]

    max_value = dp(target_weight, 0, items)
    
    # Build choices in the same structure as input
    choices: dict[str, list[dict[str, int]]] = {category: [] for category in item_weights}
    current = (target_weight, 0)

    while next.get(current):
        weight, category, item_id = items[current[1]]
        if next[current][2]:  # If the item was included in the optimal solution
            choices[category].append({"id": item_id, "weight": weight})
        current = next.get(current)[:2]
    
    return max_value, choices

max_value, choices = knapsack(10000, all_data)
print("Max Value:", max_value)
print("Choices", choices)